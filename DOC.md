# OTA Website Documentation

## Overview
OTA Website is a modern Next.js application for managing travel/tour products, bookings, and more. It features a multi-step admin product creation flow, a Neon Postgres database, and a clean, modern UI.

## How to Use the System

### 1. Admin Login
- Navigate to the admin login page (if authentication is enabled).
- Enter your admin credentials to access the dashboard.

### 2. Navigating the Admin Dashboard
- Use the left sidebar or top menu to access different sections: Products, Bookings, Performance, Finance, etc.
- The **Products** section is where you can create, view, edit, and manage all products.

### 3. Creating a New Product
- Go to **Admin → Create → New Product**.
- Fill out the 15-step multi-step product creation form.
  - Each step collects specific information (category, title, descriptions, keywords, inclusions, photos, options, itinerary, etc.).
  - The sidebar shows your progress and allows you to navigate between steps.
- The **Reference Code** field is optional. If left blank, the system will generate one automatically.
- After completing all steps, review your entries and submit the form.
- The new product will appear in the product list with a unique ID (YYMMDD01 format).

### 4. Viewing Product Details
- In the product list, click **See details** next to any product to view its full information, options, and history.
- The details page includes an actions dropdown for further management (edit, clone, deactivate, delete, etc.).

### 5. Editing a Product
- From the product details page, click **Edit product**.
- Update any fields as needed (title, reference code, etc.).
- Save your changes to update the product.

### 6. Managing Products
- Use the search and filter tools in the product list to find products by title, reference code, or status.
- Use the actions dropdown in the details page for advanced management (block out dates, view bookings, clone, deactivate, delete, etc.).

### 7. Database & API
- All product data is stored in a Neon Postgres database.
- API endpoints are available for products, bookings, and activities (see API section in README).

## Features
- 15-step multi-step product creation form
- Product management (CRUD)
- Modern admin dashboard
- Neon Postgres integration (via `pg`)
- Tailwind CSS for UI
- API routes for products, bookings, and activities
- Vercel deployment

## Product ID Format
- Product IDs are now strings in the format `YYMMDD01` (e.g., `24060101` for the first product created on June 1, 2024).
- The ID is unique, not editable, and used as the primary key for new products.
- The ID is auto-generated by the backend on product creation.

## Reference Code
- The reference code is an optional, editable, and non-unique field for internal use.
- If left blank, the backend can auto-generate a code, but it is not required to be unique.

## Setup
1. **Clone the repository:**
   ```sh
   git clone https://github.com/majidorc/ota-website.git
   cd ota-website
   ```
2. **Install dependencies:**
   ```sh
   yarn install
   ```
3. **Configure environment:**
   - Add your Neon Postgres connection string to `.env` as `DATABASE_URL`.
4. **Run migrations:**
   - Apply all SQL files in the `migrations/` directory to your Neon database, including `003_change_product_id_to_string.sql` for the new ID format.
5. **Start the app:**
   ```sh
   yarn dev
   ```

## Database Migration
- The migration `003_change_product_id_to_string.sql` changes the `id` column in the `Product` table from UUID to a string (VARCHAR), making it the primary key for new products.
- Run this migration manually on your Neon database.

## Changelog Summary
- Product ID is now a string in the format `YYMMDD01` (date-based, unique, not editable) and used as the primary key for new products.
- Reference code is now optional, editable, and not unique.
- Added migration to change the id column type in the Product table.
- Product creation API now generates the new ID format automatically.

## More Information
- See `README.md` for setup and workflow details.
- See `CHANGELOG.md` for a full list of changes. 